<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Repair Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <style>
        .form-label-sm {
            font-size: 0.875rem;
        }
        .form-control-sm {
            height: calc(1.5em + 0.5rem + 2px);
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
            border-radius: 0.2rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">BORANG</a>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                        <li><a class="nav-link" @click="fetchRecord('all')">All</a></li>
                        <li><a class="nav-link" @click="fetchRecord('new')">New</a></li>
                        <li><a class="nav-link" @click="fetchRecord('complete')">Completed</a></li>
                        <li><a class="nav-link" data-bs-toggle="modal" data-bs-target="#searchDateModal">Date</a></li>
                        <li><a class="nav-link" data-bs-toggle="modal" data-bs-target="#searchDiserahNama">District</a></li>
                    </ul>
                </div>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <span th:text="${name}">[name]</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    
        <div class="container mt-4">
            <div class="row">
    
                <!-- <div class="col-8">
                        <div class="input-group">
                            <input type="text" id="searchBar" class="form-control" placeholder="Searchbar">
                            <button class="btn btn-primary" type="button" id="searchButton">Search</button>
                        </div>
                    </div> -->
                <div class="col-auto">
                    <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
                        data-bs-target="#addReportModal">
                        Add New Report
                    </button>
                </div>
            </div>
            <table class="table" id="reportTable">
                <thead>
                    <tr>
                        <th>Model Peralatan</th>
                        <th>Tarikh Borang</th>
                        <th>Diserah oleh</th>
                        <th>Progress</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="modal fade" id="addReportModal" tabindex="-1" aria-labelledby="addReportModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addReportModalLabel">Tambah Borang</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card mb-3">
                                <div class="card-header" id="incidentInfoHeader">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">MAKLUMAT BORANG</h5>
                                        <button class="btn btn-secondary btn-sm" type="button"
                                            @click="toggleCollapse('One')" data-bs-toggle="collapse"
                                            data-bs-target="#incidentInfoCollapse" aria-expanded="true"
                                            aria-controls="incidentInfoCollapse">
                                            {{ collapseOne ? 'Hide' : 'Show' }}
                                        </button>
                                    </div>
                                </div>
                                <div id="incidentInfoCollapse" class="collapse" aria-labelledby="incidentInfoHeader">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="incidentNo" class="form-label form-label-sm">Incident No</label>
                                                <input type="text" class="form-control form-control-sm" id="incidentNo"
                                                    v-model="incidentNo" ref="incidentNo" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="incidentType" class="form-label form-label-sm">Incident
                                                    Type</label>
                                                <input type="text" class="form-control form-control-sm" id="incidentType"
                                                    v-model="incidentType" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="incidentDate" class="form-label form-label-sm">Incident
                                                    Date</label>
                                                <input type="date" class="form-control form-control-sm" id="incidentDate"
                                                    v-model="incidentDate" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="quotationNo" class="form-label form-label-sm">Quotation
                                                    No</label>
                                                <input type="text" class="form-control form-control-sm" id="quotationNo"
                                                    v-model="quotationNo" :disabled="isView">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-header" id="equipmentInfoHeader">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">PENERIMA LAPORAN</h5>
                                        <button class="btn btn-secondary btn-sm" type="button"
                                            @click="toggleCollapse('Two')" data-bs-toggle="collapse"
                                            data-bs-target="#equipmentInfoCollapse" aria-expanded="false"
                                            aria-controls="equipmentInfoCollapse">
                                            {{ collapseTwo ? 'Hide' : 'Show' }}
                                        </button>
                                    </div>
                                </div>
                                <div id="equipmentInfoCollapse" class="collapse show" aria-labelledby="equipmentInfoHeader">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="modelPeralatan" class="form-label form-label-sm">Model
                                                    Peralatan</label>
                                                <input type="text" class="form-control form-control-sm" id="modelPeralatan"
                                                    v-model="modelPeralatan" :disabled="isView">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="noSiri" class="form-label form-label-sm">No Siri</label>
                                                <input type="text" class="form-control form-control-sm" id="noSiri"
                                                    v-model="noSiri" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="diserahNama" class="form-label form-label-sm">Diserah oleh
                                                    Nama</label>
                                                <input type="text" class="form-control form-control-sm" id="diserahNama"
                                                    v-model="diserahNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diserahBhg" class="form-label form-label-sm">Diserah oleh
                                                    Bhg</label>
                                                <input type="text" class="form-control form-control-sm" id="diserahBhg"
                                                    v-model="diserahBhg" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diserahTarikh" class="form-label form-label-sm">Diserah oleh
                                                    Tarikh</label>
                                                <input type="date" class="form-control form-control-sm" id="diserahTarikh"
                                                    v-model="diserahTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="diambilNama" class="form-label form-label-sm">Diambil-balik oleh
                                                    Nama</label>
                                                <input type="text" class="form-control form-control-sm" id="diambilNama"
                                                    v-model="diambilNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diambilBhg" class="form-label form-label-sm">Diambil-balik oleh
                                                    Bhg</label>
                                                <input type="text" class="form-control form-control-sm" id="diambilBhg"
                                                    v-model="diambilBhg" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diambilTarikh" class="form-label form-label-sm">Diambil-balik
                                                    oleh Tarikh</label>
                                                <input type="date" class="form-control form-control-sm" id="diambilTarikh"
                                                    v-model="diambilTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="masalahPemohon" class="form-label form-label-sm">Masalah</label>
                                                <textarea class="form-control form-control-sm" id="masalahPemohon"
                                                    v-model="masalahPemohon" :disabled="isView"></textarea>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="penerimaNama" class="form-label form-label-sm">Penerima
                                                    Nama</label>
                                                <input type="text" class="form-control form-control-sm" id="penerimaNama"
                                                    v-model="penerimaNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="penerimaTarikh" class="form-label form-label-sm">Penerima
                                                    Tarikh</label>
                                                <input type="date" class="form-control form-control-sm" id="penerimaTarikh"
                                                    v-model="penerimaTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">JURUTEKNIK</h5>
                                    <button class="btn btn-secondary btn-sm" type="button" @click="toggleCollapse('Three')"
                                        data-bs-toggle="collapse" data-bs-target="#juruteknikCollapse" aria-expanded="false"
                                        aria-controls="juruteknikCollapse">
                                        {{ collapseThree ? 'Hide' : 'Show' }}
                                    </button>
                                </div>
                                <div class="collapse" id="juruteknikCollapse">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="juruteknikNama" class="form-label form-label-sm">Juruteknik
                                                    Nama</label>
                                                <input type="text" class="form-control form-control-sm" id="juruteknikNama"
                                                    v-model="juruteknikNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="juruteknikTarikh" class="form-label form-label-sm">Juruteknik
                                                    Tarikh</label>
                                                <input type="date" class="form-control form-control-sm"
                                                    id="juruteknikTarikh" v-model="juruteknikTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="juruteknikMasalah" class="form-label form-label-sm">Juruteknik
                                                    Masalah</label>
                                                <textarea class="form-control form-control-sm" id="juruteknikMasalah"
                                                    v-model="juruteknikMasalah" :disabled="isView"></textarea>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="juruteknikCara" class="form-label form-label-sm">Juruteknik
                                                    Cara</label>
                                                <textarea class="form-control form-control-sm" id="juruteknikCara"
                                                    v-model="juruteknikCara" :disabled="isView"></textarea>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3 mb-3">
                                                <label for="juruteknikOs" class="form-label form-label-sm">OS</label>
                                                <input type="text" class="form-control form-control-sm" id="juruteknikOs"
                                                    v-model="juruteknikOs" :disabled="isView">
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label for="juruteknikCpu" class="form-label form-label-sm">CPU</label>
                                                <input type="text" class="form-control form-control-sm" id="juruteknikCpu"
                                                    v-model="juruteknikCpu" :disabled="isView">
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label for="juruteknikRam" class="form-label form-label-sm">RAM</label>
                                                <input type="text" class="form-control form-control-sm" id="juruteknikRam"
                                                    v-model="juruteknikRam" :disabled="isView">
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label for="juruteknikHdd" class="form-label form-label-sm">HDD</label>
                                                <input type="text" class="form-control form-control-sm" id="juruteknikHdd"
                                                    v-model="juruteknikHdd" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="ipOri" class="form-label form-label-sm">IP Original</label>
                                                <input type="text" class="form-control form-control-sm" id="ipOri"
                                                    v-model="ipOri" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="ipAfter" class="form-label form-label-sm">IP After</label>
                                                <input type="text" class="form-control form-control-sm" id="ipAfter"
                                                    v-model="ipAfter" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label form-label-sm"></label>
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="ipDitukar"
                                                        v-model="ipDitukar" :disabled="isView">
                                                    <label class="form-check-label" for="ipDitukar">IP Ditukar</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-header" id="receivedReturnedInfoHeader">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">SYARIKAT PEMBEKAL</h5>
                                        <button class="btn btn-secondary btn-sm" type="button"
                                            @click="toggleCollapse('Four')" data-bs-toggle="collapse"
                                            data-bs-target="#receivedReturnedInfoCollapse" aria-expanded="false"
                                            aria-controls="receivedReturnedInfoCollapse">
                                            {{ collapseFour ? 'Hide' : 'Show' }}
                                        </button>
                                    </div>
                                </div>
                                <div id="receivedReturnedInfoCollapse" class="collapse"
                                    aria-labelledby="receivedReturnedInfoHeader">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="diterimaNama" class="form-label form-label-sm">Diterima
                                                    Nama</label>
                                                <input type="text" class="form-control form-control-sm" id="diterimaNama"
                                                    v-model="diterimaNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diterimaSyarikat" class="form-label form-label-sm">Diterima
                                                    Syarikat</label>
                                                <input type="text" class="form-control form-control-sm"
                                                    id="diterimaSyarikat" v-model="diterimaSyarikat" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="diterimaTarikh" class="form-label form-label-sm">Diterima
                                                    Tarikh</label>
                                                <label for="diterimaTarikh" class="form-label">Diterima Tarikh</label>
                                                <input type="date" class="form-control" id="diterimaTarikh"
                                                    v-model="diterimaTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="dikembaliNama" class="form-label">Dikembali Nama</label>
                                                <input type="text" class="form-control" id="dikembaliNama"
                                                    v-model="dikembaliNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="dikembaliSyarikat" class="form-label">Dikembali Syarikat</label>
                                                <input type="text" class="form-control" id="dikembaliSyarikat"
                                                    v-model="dikembaliSyarikat" :disabled="isView">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="dikembaliTarikh" class="form-label">Dikembali Tarikh</label>
                                                <input type="date" class="form-control" id="dikembaliTarikh"
                                                    v-model="dikembaliTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-header" id="officerInfoHeader">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">PEGAWAI PEMERIKSA</h5>
                                        <button class="btn btn-secondary btn-sm" type="button"
                                            @click="toggleCollapse('Five')" data-bs-toggle="collapse"
                                            data-bs-target="#officerInfoCollapse" aria-expanded="false"
                                            aria-controls="officerInfoCollapse">
                                            {{ collapseFive ? 'Hide' : 'Show' }}
                                        </button>
                                    </div>
                                </div>
                                <div id="officerInfoCollapse" class="collapse" aria-labelledby="officerInfoHeader">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="pegawaiNama" class="form-label">Pegawai Nama</label>
                                                <input type="text" class="form-control" id="pegawaiNama"
                                                    v-model="pegawaiNama" :disabled="isView">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="pegawaiTarikh" class="form-label">Pegawai Tarikh</label>
                                                <input type="date" class="form-control" id="pegawaiTarikh"
                                                    v-model="pegawaiTarikh" :disabled="isView">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" @click="save">Save Report</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="searchDateModal" tabindex="-1" role="dialog" aria-labelledby="dateModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="dateModalLabel">Search by Date</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <div class="row">
                                    <label for="startDate" class="col form-label">Dari</label>
                                    <input type="date" class="col form-control" id="startDate" v-model="startDate">
                                    <label for="endDate" class="col form-label">Sampai</label>
                                    <input type="date" class="col form-control" id="endDate" v-model="endDate">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" @click="fetchRecord('date')">Search</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="searchDiserahNama" tabindex="-1" role="dialog" aria-labelledby="diserahNamaModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="diserahNamaModalLabel">Search by District</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <div class="row">
                                    <label for="diserahSearch" class="col form-label">District</label>
                                    <select class="col form-control" id="diserahSearch" v-model="diserahSearch">
                                        <option value="">Select District</option>
                                        <option th:each="opt : ${diserahNama}" th:value="${opt}" th:text="${opt}"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" @click="fetchRecord('diserah')">Search</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.js"></script>

    <script>
        $(document).ready(function() {
            
        const app = Vue.createApp({
            data() {
                return {
                    formId:'',
                    formStatus: '',
                    incidentNo: '',
                    incidentDate: new Date().toISOString().split('T')[0],
                    incidentType: '',
                    quotationNo: '',
                    modelPeralatan: '',
                    noSiri: '',
                    diserahNama: '',
                    diserahBhg: '',
                    diserahTarikh: new Date().toISOString().split('T')[0],
                    diambilNama: '',
                    diambilBhg: '',
                    diambilTarikh: new Date().toISOString().split('T')[0],
                    masalahPemohon: '',
                    penerimaNama: '',
                    penerimaTarikh: new Date().toISOString().split('T')[0],
                    juruteknikNama: '',
                    juruteknikTarikh: new Date().toISOString().split('T')[0],
                    juruteknikMasalah: '',
                    juruteknikCara: '',
                    juruteknikOs: '',
                    juruteknikCpu: '',
                    juruteknikRam: '',
                    juruteknikHdd: '',
                    ipOri: '',
                    ipAfter: '',
                    ipDitukar: '',
                    diterimaNama: '',
                    diterimaSyarikat: '',
                    diterimaTarikh: new Date().toISOString().split('T')[0],
                    dikembaliNama: '',
                    dikembaliSyarikat: '',
                    dikembaliTarikh: new Date().toISOString().split('T')[0],
                    pegawaiNama: '',
                    pegawaiTarikh: new Date().toISOString().split('T')[0],
                    createdDate:'',
                    collapseOne: false,
                    collapseTwo: true,
                    collapseThree: false,
                    collapseFour: false,
                    collapseFive: false,
                    selRpt:'',
                    startDate:'',
                    endDate:new Date().toISOString().split('T')[0],
                    isView:false,
                    diserahSearch:'',
                }
            },mounted(){
                this.fetchRecord("all");
                $('#openPdfButton').on('click', this.openPdfModal);

            },
            methods:{
                toggleCollapse(section) {
                    this[`collapse${section}`] = !this[`collapse${section}`];
                },
                fetchRecord(condition) {
                    let self = this;
                    let reportTable = $('#reportTable').DataTable({
                        "destroy": true,
                        "autowidth": false,
                        "searching": true,
                        "lengthChange": false,
                        "paging": true,
                        "info": true,
                        "pageLength": 10,
                        "processing": true,
                        "serverSide": true,
                        "ordering": true,
                        "select": "single",
                        "ajax": {
                            "type": "GET",
                            "url": `[[@{/repairform/fetch}]]`,
                            "contentType": "application/json; charset=utf-8",
                            "data": function(d){
                                d.condition = condition;
                                d.startDate = self.startDate;
                                d.endDate = self.endDate;
                                d.diserahSearch = self.diserahSearch;
                            },
                        },
                        "columnDefs": [
                            {
                                'targets': 4,
                                "orderable":false
                            },],
                        "columns": [ 
                            { "data": "modelPeralatan" },
                            { "data": "createdDate" },
                            { "data": "diserahNama" },
                            { "data": null,
                                "render": function (data, type, row) {
                                return `<span style="color:${data.formStatus === 'C' ? 'green' : 'red'}; font-weight: bold;">${data.formStatus === 'C' ? 'Complete' : data.formStatus === 'N' ? 'Incomplete' : ''}</span>`;
                                } 
                            },
                            {
                                "data": null,
                                "render": function (data, type, row) {
                                    return `<button class="btn btn-sm btn-warning" @click="viewForm('${row.formId}')">View</button>
                                            <button class="btn btn-sm btn-primary" @click="editForm('${row.formId}')">Edit</button>
                                            <button class="btn btn-sm btn-danger" @click="deleteForm('${row.formId}')">Delete</button>
                                            <button class="btn btn-sm btn-secondary" @click="printForm('${row.formId}')">Print</button>
                                            ${data.formStatus !== 'C' ? `<button class="btn btn-sm btn-success" @click="editReport('${row.formId}')">Complete</button>` : ''}`;
                                }
                            }
                        ],
                        "rowCallback": function (row, data) {

                            if (new Date(data.createdDate).toDateString() === new Date().toDateString()) {
                                if (data.formStatus === "C") {
                                    $(row).addClass('table-success');
                                } else {
                                    $(row).addClass('table-warning');
                                }
                            }
                        }
                    });

                    $('#searchDateModal').modal('hide');
                    
                    reportTable.on('click', 'button.btn-success', (event) => {
                        event.preventDefault();
                        const data = reportTable.row($(event.target).closest('tr')).data();
                        if (data) { 
                            this.completeForm(data.formId);
                        }
                    });
                    reportTable.on('click', 'button.btn-warning', (event) => {
                        event.preventDefault();
                        const data = reportTable.row($(event.target).closest('tr')).data();
                        if (data) { 
                            this.viewForm(data.formId);
                        }
                    });
                    reportTable.on('click', 'button.btn-primary', (event) => {
                        event.preventDefault();
                        const data = reportTable.row($(event.target).closest('tr')).data();
                        if (data) { 
                            this.editForm(data.formId);
                        }
                    });
                    reportTable.on('click', 'button.btn-danger', (event) => {
                        event.preventDefault();
                        const data = reportTable.row($(event.target).closest('tr')).data();
                        if (data) { 
                            this.deleteForm(data.formId);
                        }
                    });

                    reportTable.on('click', 'button.btn-secondary', (event) => {
                        event.preventDefault();
                        const data = reportTable.row($(event.target).closest('tr')).data();
                        if (data) { 
                            this.openPdfModal(data.formId);
                        }
                    });

                    

                    
                },
                save(){
                    var data={
                        formId : this.formId,
                        incidentNo: this.incidentNo,
                        incidentDate: this.incidentDate,
                        incidentType: this.incidentType,
                        quotationNo: this.quotationNo,
                        modelPeralatan: this.modelPeralatan,
                        noSiri: this.noSiri,
                        diserahNama: this.diserahNama,
                        diserahBhg: this.diserahBhg,
                        diserahTarikh: this.diserahTarikh,
                        diambilNama: this.diambilNama,
                        diambilBhg: this.diambilBhg,
                        diambilTarikh: this.diambilTarikh,
                        masalahPemohon: this.masalahPemohon,
                        penerimaNama: this.penerimaNama,
                        penerimaTarikh: this.penerimaTarikh,
                        juruteknikNama: this.juruteknikNama,
                        juruteknikTarikh: this.juruteknikTarikh,
                        juruteknikMasalah: this.juruteknikMasalah,
                        juruteknikCara: this.juruteknikCara,
                        juruteknikOs: this.juruteknikOs,
                        juruteknikCpu: this.juruteknikCpu,
                        juruteknikRam: this.juruteknikRam,
                        juruteknikHdd: this.juruteknikHdd,
                        ipOri: this.ipOri,
                        ipAfter: this.ipAfter,
                        ipDitukar: this.ipDitukar,
                        diterimaNama: this.diterimaNama,
                        diterimaSyarikat: this.diterimaSyarikat,
                        diterimaTarikh: this.diterimaTarikh,
                        dikembaliNama: this.dikembaliNama,
                        dikembaliSyarikat: this.dikembaliSyarikat,
                        dikembaliTarikh: this.dikembaliTarikh,
                        pegawaiNama: this.pegawaiNama,
                        pegawaiTarikh: this.pegawaiTarikh,
                    }
                    $.post({
                      url: `[[@{/repairform/save}]]`,
                      data: JSON.stringify(data),
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      success: function (res) {
                        window.location.reload();
                      }}
                    )
                   
                },
                resetForm(){
                    let self = this;
                    self.incidentNo = '';
                    self.incidentDate = new Date().toISOString().split('T')[0];
                    self.incidentType = '';
                    self.quotationNo = '';
                    self.modelPeralatan = '';
                    self.noSiri = '';
                    self.diserahNama = '';
                    self.diserahBhg = '';
                    self.diserahTarikh = new Date().toISOString().split('T')[0];
                    self.diambilNama = '';
                    self.diambilBhg = '';
                    self.diambilTarikh = new Date().toISOString().split('T')[0];
                    self.masalahPemohon = '';
                    self.penerimaNama = '';
                    self.penerimaTarikh = new Date().toISOString().split('T')[0];
                    self.juruteknikNama = '';
                    self.juruteknikTarikh = new Date().toISOString().split('T')[0];
                    self.juruteknikMasalah = '';
                    self.juruteknikCara = '';
                    self.juruteknikOs = '';
                    self.juruteknikCpu = '';
                    self.juruteknikRam = '';
                    self.juruteknikHdd = '';
                    self.ipOri = '';
                    self.ipAfter = '';
                    self.ipDitukar = '';
                    self.diterimaNama = '';
                    self.diterimaSyarikat = '';
                    self.diterimaTarikh = new Date().toISOString().split('T')[0];
                    self.dikembaliNama = '';
                    self.dikembaliSyarikat = '';
                    self.dikembaliTarikh = new Date().toISOString().split('T')[0];
                    self.pegawaiNama = '';
                    self.pegawaiTarikh = new Date().toISOString().split('T')[0];
                    self.formId = '';
                },
                viewForm(id){
                    let self = this;
                    $.get({
                      url: `[[@{/repairform/getDetail}]]?param=` + id,
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      success: function (res) {
                        console.log(res);
                        $('#addReportModal').modal('show');
                        self.isView = true;
                        self.incidentNo = res.incidentNo;
                        self.incidentDate = res.incidentDate;
                        self.incidentType = res.incidentType;
                        self.quotationNo = res.quotationNo;
                        self.modelPeralatan = res.modelPeralatan;
                        self.noSiri = res.noSiri;
                        self.diserahNama = res.diserahNama;
                        self.diserahBhg = res.diserahBhg;
                        self.diserahTarikh = res.diserahTarikh;
                        self.diambilNama = res.diambilNama;
                        self.diambilBhg = res.diambilBhg;
                        self.diambilTarikh = res.diambilTarikh;
                        self.masalahPemohon = res.masalahPemohon;
                        self.penerimaNama = res.penerimaNama;
                        self.penerimaTarikh = res.penerimaTarikh;
                        self.juruteknikNama = res.juruteknikNama;
                        self.juruteknikTarikh = res.juruteknikTarikh;
                        self.juruteknikMasalah = res.juruteknikMasalah;
                        self.juruteknikCara = res.juruteknikCara;
                        self.juruteknikOs = res.juruteknikOs;
                        self.juruteknikCpu = res.juruteknikCpu;
                        self.juruteknikRam = res.juruteknikRam;
                        self.juruteknikHdd = res.juruteknikHdd;
                        self.ipOri = res.ipOri;
                        self.ipAfter = res.ipAfter;
                        self.ipDitukar = res.ipDitukar;
                        self.diterimaNama = res.diterimaNama;
                        self.diterimaSyarikat = res.diterimaSyarikat;
                        self.diterimaTarikh = res.diterimaTarikh;
                        self.dikembaliNama = res.dikembaliNama;
                        self.dikembaliSyarikat = res.dikembaliSyarikat;
                        self.dikembaliTarikh = res.dikembaliTarikh;
                        self.pegawaiNama = res.pegawaiNama;
                        self.pegawaiTarikh = res.pegawaiTarikh;
                        self.formId = id;

                        $('#addReportModal').on('hidden.bs.modal', function () {
                          self.resetForm();
                          self.isView = false;

                        });
                      }}
                    )
                },
                editForm(id){
                    let self = this;
                    $.get({
                      url: `[[@{/repairform/getDetail}]]?param=` + id,
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      success: function (res) {
                        console.log(res);
                        $('#addReportModal').modal('show');

                        self.incidentNo = res.incidentNo;
                        self.incidentDate = res.incidentDate;
                        self.incidentType = res.incidentType;
                        self.quotationNo = res.quotationNo;
                        self.modelPeralatan = res.modelPeralatan;
                        self.noSiri = res.noSiri;
                        self.diserahNama = res.diserahNama;
                        self.diserahBhg = res.diserahBhg;
                        self.diserahTarikh = res.diserahTarikh;
                        self.diambilNama = res.diambilNama;
                        self.diambilBhg = res.diambilBhg;
                        self.diambilTarikh = res.diambilTarikh;
                        self.masalahPemohon = res.masalahPemohon;
                        self.penerimaNama = res.penerimaNama;
                        self.penerimaTarikh = res.penerimaTarikh;
                        self.juruteknikNama = res.juruteknikNama;
                        self.juruteknikTarikh = res.juruteknikTarikh;
                        self.juruteknikMasalah = res.juruteknikMasalah;
                        self.juruteknikCara = res.juruteknikCara;
                        self.juruteknikOs = res.juruteknikOs;
                        self.juruteknikCpu = res.juruteknikCpu;
                        self.juruteknikRam = res.juruteknikRam;
                        self.juruteknikHdd = res.juruteknikHdd;
                        self.ipOri = res.ipOri;
                        self.ipAfter = res.ipAfter;
                        self.ipDitukar = res.ipDitukar;
                        self.diterimaNama = res.diterimaNama;
                        self.diterimaSyarikat = res.diterimaSyarikat;
                        self.diterimaTarikh = res.diterimaTarikh;
                        self.dikembaliNama = res.dikembaliNama;
                        self.dikembaliSyarikat = res.dikembaliSyarikat;
                        self.dikembaliTarikh = res.dikembaliTarikh;
                        self.pegawaiNama = res.pegawaiNama;
                        self.pegawaiTarikh = res.pegawaiTarikh;
                        self.formId = id;

                        $('#addReportModal').on('hidden.bs.modal', function () {
                            self.resetForm();
                        });
                      }}
                    )
                },
                completeForm(id){
                    $.get({
                      url: `[[@{/repairform/complete}]]?param=` + id,
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      success: function (res) {
                        window.location.reload();
                      }}
                    )
                },
                deleteForm(id){
                    $.post({
                      url: `[[@{/repairform/delete}]]?param=` + id,
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      success: function (res) {
                        window.location.reload();
                      }}
                    )
                },
                pdf(){
                    window.open(`[[@{/repairform/report}]]`, "_blank");
                },
                openPdfModal(id) {
                    console.log(id);
                    window.open(`[[@{/repairform/pdf}]]?formid=` + id, '_blank', 'location=yes, height=1080, width=1000, scrollbars=yes, status=yes');
                },
                
            },
        });
        app.mount('#app');
    });
    </script>
</body>
</html>